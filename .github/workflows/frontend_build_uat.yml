name: ðŸ“¦ðŸš€ Build & deploy UAT release

permissions: write-all

on:
  push:
    branches:
      - "feature/ci-cd-ios-flow"
    paths-ignore:
      - "**.md"
      - ".vscode/"

jobs:
  git_release:
    name: "Create Git Release"
    uses: ./.github/workflows/git_release_versioning.yml

  print_my_var:
    needs: git_release
    runs-on: ubuntu-latest
    steps:
      - name: "Print my_var"
        run: echo my_var [${{ env.CURRENT_VERSION }}]

  analyze_before_build:
    name: ðŸ“Š Analyze before build
    uses: ./.github/workflows/analyze.yml
    secrets: inherit
    needs: git_release
    with:
      new-pubspec-version: ${{ needs.gitRelease.outputs.new_pubspec_version }}

  deployUat:
    name: Deploy UAT
    uses: ./.github/workflows/_frontend_env_build.yml
    needs: ["gitRelease", "analyze_before_build"]
    secrets: inherit
    with:
      android-environment-name: "Android DEV"
      android-environment-url: "https://play.google.com/console/u/0/developers/7200533445067191438/app/4975719898219218293/tracks/internal-testing"
      android-package-name: "com.quickcare.hr.dev"
      android-release-status: "completed"
      short-environment-name: "DEV"
      flavor: "dev"
      new-pubspec-version: ${{ needs.gitRelease.outputs.new_pubspec_version }}
